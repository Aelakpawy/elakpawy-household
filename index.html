<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Personal Finance — Mobile</title>
  <style>
    :root{--bg:#0b1020;--card:#121832;--card2:#0f1429;--text:#e6e9f5;--muted:#94a3b8;--accent:#7c5cff;--accent2:#00e0ff;--danger:#ff5c7a;--ok:#22c55e;--warn:#f59e0b;--border:rgba(255,255,255,.08)}
    *{box-sizing:border-box}
    html,body{margin:0;height:100%;background:linear-gradient(180deg,#0b1020,#0b1020 60%,#0e1330);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif}
    .wrap{max-width:480px;margin:0 auto;padding:16px 16px 84px}
    h1{font-size:22px;margin:0 0 8px}
    .muted{color:var(--muted)}
    .row{display:flex;gap:10px;align-items:center}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;box-shadow:0 8px 32px rgba(0,0,0,.35)}
    .chip{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px;border:1px solid var(--border);background:linear-gradient(180deg,#0f1736,#0d1230)}
    .kpi{display:grid;grid-template-columns:1fr auto;gap:6px;align-items:end}
    .kpi .v{font-weight:800;font-size:22px}
    .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;font-size:12px}
    .pill.ok{background:rgba(34,197,94,.15);color:#bbf7d0}
    .pill.warn{background:rgba(245,158,11,.15);color:#fde68a}
    .pill.bad{background:rgba(255,92,122,.15);color:#fecdd3}
    .grid{display:grid;gap:12px}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;background:linear-gradient(90deg,var(--accent),var(--accent2));border:none;color:#061226;padding:12px 14px;border-radius:12px;font-weight:700;cursor:pointer}
    .btn.ghost{background:#0c1430;border:1px solid var(--border);color:#cbd5e1}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;text-align:left;border-top:1px solid var(--border);font-size:14px}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0f1736;color:var(--text)}
    .tabs{position:fixed;left:0;right:0;bottom:0;background:#0b1020;border-top:1px solid var(--border);display:flex;max-width:480px;margin:0 auto;padding:8px;gap:8px}
    .tab{flex:1;padding:10px;border-radius:12px;text-align:center;background:#0f1730;border:1px solid var(--border);color:#cbd5e1}
    .tab.active{background:linear-gradient(90deg,#1a2148,#111842);color:#fff}
    .hide{display:none}
    .progress{height:10px;background:#0d1535;border-radius:999px;overflow:hidden}
    .progress>span{display:block;height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2))}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between">
      <div>
        <h1>Personal Finance — Mobile</h1>
        <div class="muted" id="sub">Local only • Private</div>
      </div>
      <button id="shareBtn" class="btn" style="padding:10px 12px">Share</button>
    </div>

    <!-- CASH POSITION -->
    <div class="grid" style="margin-top:12px">
      <div class="card">
        <div class="row" style="justify-content:space-between"><strong>Current Cash Position</strong><span class="chip">as of now</span></div>
        <div class="grid" style="margin-top:10px">
          <div class="kpi"><div class="muted">N26</div><div class="v" id="c_n26">€0</div></div>
          <div class="kpi"><div class="muted">Revolut</div><div class="v" id="c_rev">€0</div></div>
          <div class="kpi"><div class="muted">Credit card (limit)</div><div class="v" id="c_cc">€0</div></div>
          <div class="kpi"><div><strong>Total liquid cash</strong></div><div class="v" id="c_total">€0</div></div>
        </div>
      </div>

      <!-- MONTH OUTLOOK -->
      <div class="card">
        <div class="row" style="justify-content:space-between"><strong>This Month’s Outlook</strong><span class="chip" id="monthLbl">This month</span></div>
        <div class="grid" style="margin-top:8px">
          <div class="kpi"><div class="muted">Cash available now</div><div class="v" id="m_cash">€0</div></div>
          <div class="kpi"><div class="muted">Fixed expenses</div><div class="v" id="m_fixed">€0</div></div>
          <div class="kpi"><div class="muted">Groceries (est.)</div><div class="v" id="m_groc">€0</div></div>
          <div class="kpi"><div><strong>Projected shortfall</strong></div><div class="v" id="m_short">€0</div></div>
          <div id="shortBadge" class="pill bad">Shortfall — consider card/overdraft</div>
        </div>
      </div>

      <!-- FIXED EXPENSES LIST -->
      <div class="card">
        <div class="row" style="justify-content:space-between"><strong>Fixed Expenses (monthly)</strong><button class="btn ghost" id="editFx">Edit</button></div>
        <div style="overflow:auto;max-height:260px">
          <table>
            <thead><tr><th>Item</th><th style="text-align:right">€</th></tr></thead>
            <tbody id="fxBody"></tbody>
            <tfoot><tr><th>Total</th><th style="text-align:right" id="fxTotal">€0</th></tr></tfoot>
          </table>
        </div>
      </div>

      <!-- DEBT -->
      <div class="card">
        <div class="row" style="justify-content:space-between"><strong>N26 Loan</strong><span class="chip" id="loanChip"></span></div>
        <div class="grid" style="margin-top:8px">
          <div class="kpi"><div class="muted">Balance</div><div class="v" id="d_bal">€0</div></div>
          <div class="kpi"><div class="muted">Monthly installment</div><div class="v" id="d_inst">€0</div></div>
          <div class="kpi"><div class="muted">Est. months to close</div><div class="v" id="d_months">—</div></div>
        </div>
        <div class="progress" style="margin-top:10px"><span id="d_prog" style="width:0%"></span></div>
      </div>

      <!-- CHARTS -->
      <div class="card">
        <div class="row" style="justify-content:space-between"><strong>Spending by Category</strong><span class="chip">auto-updating</span></div>
        <canvas id="pie" height="200"></canvas>
      </div>
    </div>
  </div>

  <!-- Bottom Tabs -->
  <div class="tabs">
    <button class="tab active" data-tab="home">Home</button>
    <button class="tab" data-tab="tx">Transactions</button>
    <button class="tab" data-tab="budgets">Budgets</button>
    <button class="tab" data-tab="settings">Settings</button>
  </div>

<script>
(function(){
  const EURO = n => new Intl.NumberFormat('de-DE',{style:'currency',currency:'EUR',maximumFractionDigits:2}).format(Number(n||0));
  const state = {
    profile:{ currency:'€', groceriesEstimate: 350 },
    cash:{ n26: 237.19, revolut: 56.00, ccLimit: 2000.00 },
    fixedExpenses:[
      ['N26 bank fees',16.90],['O2',30.00],['eSIM',20.00],['Loan installment',240.04],['Rent',1440.00],['Kindle',11.75],['Amazon Prime',8.99],['Revolut Metal',14.00],['Netflix',14.00],['WOW TV',6.00],['Whoop',40.00],['OpenAI',23.00],['Schufa',5.00],['Apple One',25.00]
    ],
    loan:{ balance:3129.61, installment:240.04, startBalance:3129.61 },
    expensesMock:[
      {category:'Rent', amount:1440.00},{category:'Telecom',amount:50.00},{category:'Banking',amount:16.90},{category:'Streaming',amount:63.99},{category:'Fitness',amount:40.00},{category:'Subscriptions',amount:23.00}
    ]
  };

  // Derived totals
  function fixedTotal(){ return state.fixedExpenses.reduce((a,[,v])=>a+Number(v||0),0) }

  // Render cash position
  function renderCash(){
    byId('c_n26').textContent = EURO(state.cash.n26);
    byId('c_rev').textContent = EURO(state.cash.revolut);
    byId('c_cc').textContent = EURO(state.cash.ccLimit);
    byId('c_total').textContent = EURO(state.cash.n26 + state.cash.revolut);
  }

  // Month outlook
  function renderOutlook(){
    const cashAvail = state.cash.n26 + state.cash.revolut;
    const fixed = fixedTotal();
    const groc = state.profile.groceriesEstimate;
    const short = Math.max(0, fixed + groc - cashAvail);
    byId('m_cash').textContent = EURO(cashAvail);
    byId('m_fixed').textContent = EURO(fixed);
    byId('m_groc').textContent = EURO(groc);
    byId('m_short').textContent = EURO(short);
    const badge = byId('shortBadge');
    badge.textContent = short>0 ? `Shortfall ${EURO(short)} — consider card/overdraft` : 'OK — covered';
    badge.className = 'pill ' + (short>0 ? (short>1000? 'bad':'warn') : 'ok');
  }

  // Fixed list
  function renderFixed(){
    const body = byId('fxBody'); body.innerHTML='';
    state.fixedExpenses.forEach(([name,val])=>{
      const tr=document.createElement('tr');
      tr.innerHTML = `<td>${name}</td><td style="text-align:right">${EURO(val)}</td>`;
      body.appendChild(tr);
    });
    byId('fxTotal').textContent = EURO(fixedTotal());
  }

  // Loan
  function renderLoan(){
    const mths = Math.ceil(state.loan.balance / Math.max(1,state.loan.installment));
    byId('d_bal').textContent = EURO(state.loan.balance);
    byId('d_inst').textContent = EURO(state.loan.installment);
    byId('d_months').textContent = isFinite(mths)? mths+' mo' : '—';
    const pct = Math.max(0, 100 * (1 - state.loan.balance / state.loan.startBalance));
    byId('d_prog').style.width = pct + '%';
    byId('loanChip').textContent = pct.toFixed(0)+'% paid';
  }

  // Pie chart
  let pieChart;
  function renderPie(){
    const ctx = byId('pie');
    const labels = state.expensesMock.map(x=>x.category);
    const data = state.expensesMock.map(x=>x.amount);
    if(pieChart) pieChart.destroy();
    pieChart = new Chart(ctx,{type:'pie',data:{labels,datasets:[{data}]},options:{plugins:{legend:{position:'bottom'}},aspectRatio:1.6}});
  }

  // Share — encodes current state (cash + fixed + loan) in URL hash
  byId('shareBtn').onclick = ()=>{
    const payload = {profile: state.profile, cash: state.cash, fixedExpenses: state.fixedExpenses, loan: state.loan};
    const link = location.origin+location.pathname+'#data='+btoa(encodeURIComponent(JSON.stringify(payload)));
    navigator.clipboard.writeText(link).then(()=>alert('Link copied — open on your phone.')).catch(()=>prompt('Copy link',link));
  }

  // Helpers
  function byId(id){ return document.getElementById(id) }

  function update(){
    renderCash();
    renderOutlook();
    renderFixed();
    renderLoan();
    renderPie();
  }

  // If there is a #data= payload, load it
  (function checkHash(){
    const h = location.hash.startsWith('#data=')? location.hash.slice(6):'';
    if(h){
      try{ const obj = JSON.parse(decodeURIComponent(atob(h))); Object.assign(state, obj); }
      catch{}
    }
  })();

  // Initial
  document.getElementById('monthLbl').textContent = new Date().toLocaleString('en-US',{month:'long', year:'numeric'});
  update();
})();
</script>
</body>
</html>
