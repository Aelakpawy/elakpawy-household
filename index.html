<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Personal Finance Dashboard</title>
  <style>
    :root { --bg:#f6f7fb; --card:#ffffff; --text:#1f2937; --muted:#6b7280; --accent:#3b82f6; --danger:#ef4444; --ok:#059669; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,sans-serif;color:var(--text)}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    header{display:flex;flex-wrap:wrap;gap:12px;align-items:center;justify-content:space-between;margin-bottom:12px}
    h1{font-size:22px;margin:0}
    .btn{display:inline-flex;align-items:center;gap:8px;background:#fff;border:1px solid #e5e7eb;border-radius:10px;padding:8px 12px;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}
    .btn.danger{background:var(--danger);color:#fff;border-color:var(--danger)}
    .grid{display:grid;gap:12px}
    .kpis{grid-template-columns:repeat(4,minmax(0,1fr))}
    @media (max-width:900px){.kpis{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:520px){.kpis{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid #e5e7eb;border-radius:14px;padding:14px}
    .muted{color:var(--muted);font-size:12px}
    .kpi .value{font-size:22px;font-weight:700;margin-top:2px}
    nav.tabs{display:flex;gap:8px;margin:8px 0}
    nav.tabs button{padding:8px 12px;border-radius:999px;border:1px solid #e5e7eb;background:#fff;cursor:pointer}
    nav.tabs button.active{background:var(--accent);border-color:var(--accent);color:#fff}
    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;text-align:left;border-top:1px solid #e5e7eb;font-size:14px}
    input[type="text"],input[type="number"],input[type="date"]{width:100%;padding:8px;border:1px solid #e5e7eb;border-radius:8px}
    .actions button{margin-right:6px}
    .footer-tip{font-size:12px;color:var(--muted);margin-top:8px}
    .row{display:flex;gap:8px;flex-wrap:wrap}
  </style>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <h1>Personal Finance Dashboard</h1>
        <div class="muted">Live charts, preloaded data, local save. No installs.</div>
      </div>
      <div class="row">
        <button id="exportBtn" class="btn">Export JSON</button>
        <label class="btn" for="importFile">Import JSON<input id="importFile" type="file" accept="application/json" style="display:none"></label>
        <button id="resetBtn" class="btn">Reset Demo</button>
      </div>
    </header>

    <div class="grid kpis">
      <div class="card kpi"><div class="muted">Total Income</div><div id="kpiIncome" class="value">€0</div></div>
      <div class="card kpi"><div class="muted">Total Expenses</div><div id="kpiExpense" class="value">€0</div></div>
      <div class="card kpi"><div class="muted">Net</div><div id="kpiNet" class="value">€0</div></div>
      <div class="card kpi"><div class="muted">Savings Rate</div><div id="kpiRate" class="value">0%</div></div>
    </div>

    <nav class="tabs">
      <button data-tab="dashboard" class="active">Dashboard</button>
      <button data-tab="incomes">Incomes</button>
      <button data-tab="expenses">Expenses</button>
    </nav>

    <!-- DASHBOARD -->
    <section id="dashboard" class="grid" style="grid-template-columns:1fr 2fr; gap:12px;">
      <div class="card">
        <div class="muted" style="margin-bottom:8px">Expense Breakdown</div>
        <canvas id="pie"></canvas>
      </div>
      <div class="card">
        <div class="muted" style="margin-bottom:8px">Monthly Cashflow</div>
        <canvas id="bars"></canvas>
      </div>
      <div class="card" style="grid-column:1/-1">
        <div class="muted" style="margin-bottom:8px">Net Worth Trend</div>
        <canvas id="line"></canvas>
      </div>
    </section>

    <!-- INCOMES -->
    <section id="incomes" style="display:none">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Incomes</strong>
          <button id="addIncome" class="btn primary">Add</button>
        </div>
        <div style="overflow:auto">
          <table>
            <thead><tr><th>Date</th><th>Source</th><th>Amount (€)</th><th>Actions</th></tr></thead>
            <tbody id="incomeBody"></tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- EXPENSES -->
    <section id="expenses" style="display:none">
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:8px">
          <strong>Expenses</strong>
          <button id="addExpense" class="btn primary">Add</button>
        </div>
        <div style="overflow:auto">
          <table>
            <thead><tr><th>Date</th><th>Category</th><th>Note</th><th>Amount (€)</th><th>Actions</th></tr></thead>
            <tbody id="expenseBody"></tbody>
          </table>
        </div>
        <div class="footer-tip">Tip: Categories power the pie chart automatically.</div>
      </div>
    </section>
  </div>

<script>
(function(){
  const LS_KEY = 'finance-dashboard-v1-vanilla';
  const euro = n => new Intl.NumberFormat('de-DE',{style:'currency',currency:'EUR',maximumFractionDigits:0}).format(Number(n||0));
  const monthKey = d => (d||'').slice(0,7);

  const demo = {
    incomes:[{ id:crypto.randomUUID(), date:'2025-08-01', source:'Salary', amount:4200 },
             { id:crypto.randomUUID(), date:'2025-08-15', source:'Freelance', amount:650 }],
    expenses:[{ id:crypto.randomUUID(), date:'2025-08-02', category:'Rent', note:'Munich flat', amount:1500 },
              { id:crypto.randomUUID(), date:'2025-08-03', category:'Groceries', note:'REWE/EDEKA', amount:320 },
              { id:crypto.randomUUID(), date:'2025-08-04', category:'Transport', note:'MVV', amount:80 },
              { id:crypto.randomUUID(), date:'2025-08-05', category:'Dining', note:'Lunch & coffee', amount:140 },
              { id:crypto.randomUUID(), date:'2025-08-08', category:'Subscriptions', note:'iCloud, Netflix', amount:35 },
              { id:crypto.randomUUID(), date:'2025-08-10', category:'Healthcare', note:'Insurance', amount:220 }],
    netWorthHistory:[{month:'2025-04',value:7200},{month:'2025-05',value:8150},
                     {month:'2025-06',value:8920},{month:'2025-07',value:9480},
                     {month:'2025-08',value:10350}]
  };

  let state = load() || demo;

  // Tab switch
  const sections={dashboard:document.getElementById('dashboard'),incomes:document.getElementById('incomes'),expenses:document.getElementById('expenses')};
  document.querySelectorAll('nav.tabs button').forEach(btn=>{
    btn.addEventListener('click',()=>{
      document.querySelectorAll('nav.tabs button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      Object.keys(sections).forEach(k=>sections[k].style.display='none');
      sections[btn.dataset.tab].style.display='block';
    })
  });

  // Tables
  const incomeBody=document.getElementById('incomeBody'), expenseBody=document.getElementById('expenseBody');
  function renderTables(){
    incomeBody.innerHTML='';
    state.incomes.forEach(row=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td><input type="date" value="${row.date}"/></td>
        <td><input type="text" value="${row.source}"/></td>
        <td><input type="number" step="0.01" value="${row.amount}"/></td>
        <td class="actions"><button class="btn danger">Delete</button></td>`;
      const [d,s,a]=tr.querySelectorAll('input');
      d.oninput=e=>{row.date=e.target.value;update()}; s.oninput=e=>{row.source=e.target.value;update()};
      a.oninput=e=>{row.amount=Number(e.target.value||0);update()};
      tr.querySelector('button').onclick=()=>{state.incomes=state.incomes.filter(x=>x!==row);update()};
      incomeBody.appendChild(tr);
    });

    expenseBody.innerHTML='';
    state.expenses.forEach(row=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td><input type="date" value="${row.date}"/></td>
        <td><input type="text" value="${row.category}"/></td>
        <td><input type="text" value="${row.note}"/></td>
        <td><input type="number" step="0.01" value="${row.amount}"/></td>
        <td class="actions"><button class="btn danger">Delete</button></td>`;
      const [d,c,n,a]=tr.querySelectorAll('input');
      d.oninput=e=>{row.date=e.target.value;update()};
      c.oninput=e=>{row.category=e.target.value;update()};
      n.oninput=e=>{row.note=e.target.value;update()};
      a.oninput=e=>{row.amount=Number(e.target.value||0);update()};
      tr.querySelector('button').onclick=()=>{state.expenses=state.expenses.filter(x=>x!==row);update()};
      expenseBody.appendChild(tr);
    });
  }
  document.getElementById('addIncome').onclick=()=>{state.incomes.push({id:crypto.randomUUID(),date:new Date().toISOString().slice(0,10),source:'Other',amount:0});update()};
  document.getElementById('addExpense').onclick=()=>{state.expenses.push({id:crypto.randomUUID(),date:new Date().toISOString().slice(0,10),category:'Misc',note:'',amount:0});update()};

  // KPIs
  function totals(){const ti=state.incomes.reduce((a,b)=>a+Number(b.amount||0),0), te=state.expenses.reduce((a,b)=>a+Number(b.amount||0),0), net=ti-te, rate=ti?Math.max(0,Math.min(100,Math.round((net/ti)*100))):0; return{ti,te,net,rate};}
  function renderKPIs(){const{ti,te,net,rate}=totals();document.getElementById('kpiIncome').textContent=euro(ti);document.getElementById('kpiExpense').textContent=euro(te);document.getElementById('kpiNet').textContent=euro(net);document.getElementById('kpiRate').textContent=rate+'%';}

  // Charts
  let pieChart,barChart,lineChart;
  function dataByCategory(){const m={};state.expenses.forEach(e=>{m[e.category]=(m[e.category]||0)+Number(e.amount||0)});return{labels:Object.keys(m),values:Object.values(m)};}
  function cashflow(){const m={};[...state.incomes,...state.expenses].forEach(r=>{if(r.date){const k=monthKey(r.date);m[k]=m[k]||{income:0,expense:0}}});state.incomes.forEach(r=>{const k=monthKey(r.date);m[k].income+=Number(r.amount||0)});state.expenses.forEach(r=>{const k=monthKey(r.date);m[k].expense+=Number(r.amount||0)});const months=Object.keys(m).sort();return{months,income:months.map(mm=>m[mm].income),expense:months.map(mm=>m[mm].expense)}}  
  function renderCharts(){const cat=dataByCategory(),cf=cashflow();if(pieChart)pieChart.destroy();if(barChart)barChart.destroy();if(lineChart)lineChart.destroy();pieChart=new Chart(document.getElementById('pie'),{type:'pie',data:{labels:cat.labels,datasets:[{data:cat.values}]},options:{plugins:{legend:{position:'bottom'}}}});barChart=new Chart(document.getElementById('bars'),{type:'bar',data:{labels:cf.months,datasets:[{label:'Income',data:cf.income},{label:'Expenses',data:cf.expense}]} ,options:{responsive:true,plugins:{legend:{position:'bottom'}},scales:{y:{beginAtZero:true}}}});lineChart=new Chart(document.getElementById('line'),{type:'line',data:{labels:state.netWorthHistory.map(x=>x.month),datasets:[{label:'Net Worth',data:state.netWorthHistory.map(x=>x.value)}]},options:{responsive:true,plugins:{legend:{position:'bottom'}}}})}

  // Import/Export/Reset
  document.getElementById('exportBtn').onclick=()=>{const blob=new Blob([JSON.stringify(state,null,2)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='finance-data.json';a.click();URL.revokeObjectURL(url)};
  document.getElementById('importFile').onchange=e=>{const f=e.target.files&&e.target.files[0];if(!f)return;const r=new FileReader();r.onload=()=>{try{const obj=JSON.parse(r.result);if(obj&&obj.incomes&&obj.expenses){state=obj;update()}}catch{alert('Invalid JSON')}};r.readAsText(f)};
  document.getElementById('resetBtn').onclick=()=>{state=JSON.parse(JSON.stringify(demo));update()};

  // Storage
  function save(){localStorage.setItem(LS_KEY,JSON.stringify(state))}
  function load(){try{return JSON.parse(localStorage.getItem(LS_KEY))}catch{return null}}

  function update(){save();renderTables();renderKPIs();renderCharts()}
  update();
})();
</script>
</body>
</html>
